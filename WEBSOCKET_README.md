# WeHand Tennis App - WebSocket ì±„íŒ… ê¸°ëŠ¥

ì´ ë¬¸ì„œëŠ” WeHand í…Œë‹ˆìŠ¤ ì•±ì˜ ì‹¤ì‹œê°„ ì±„íŒ… ê¸°ëŠ¥ì— ëŒ€í•œ êµ¬í˜„ ì„¤ëª…ìž…ë‹ˆë‹¤.

## ðŸš€ WebSocket ëª©ì„œë²„ ê¸°ëŠ¥

### ì£¼ìš” íŠ¹ì§•

- **ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì†¡ìˆ˜ì‹ **: WebSocketì„ í†µí•œ ì¦‰ì‹œ ë©”ì‹œì§€ ì „ë‹¬
- **ìžë™ ë©”ì‹œì§€ ìƒì„±**: 30ì´ˆ~2ë¶„ ê°„ê²©ìœ¼ë¡œ ëžœë¤ ë©”ì‹œì§€ ìžë™ ìƒì„±
- **ë‹¤ì¤‘ ì±„íŒ…ë°© ì§€ì›**: ì—¬ëŸ¬ ì±„íŒ…ë°© ë™ì‹œ ê´€ë¦¬
- **ì—°ê²° ìƒíƒœ ê´€ë¦¬**: ì—°ê²°/ì—°ê²° ì¤‘/ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
- **ë©”ì‹œì§€ ížˆìŠ¤í† ë¦¬**: ì±„íŒ…ë°© ìž…ìž¥ ì‹œ ê¸°ì¡´ ë©”ì‹œì§€ ë¡œë“œ
- **ì‹œìŠ¤í…œ ë©”ì‹œì§€**: ìž…ìž¥/í‡´ìž¥ ë“± ì‹œìŠ¤í…œ ì•Œë¦¼

### êµ¬í˜„ëœ íŒŒì¼

#### 1. ëª©ì„œë²„ (`src/mocks/websocket-server.ts`)

```typescript
// ì£¼ìš” í´ëž˜ìŠ¤
- MockWebSocketServer: ì „ì²´ WebSocket ì„œë²„ ì‹œë®¬ë ˆì´ì…˜
- MockWebSocket: í´ë¼ì´ì–¸íŠ¸ WebSocket ì—°ê²° ì‹œë®¬ë ˆì´ì…˜

// ì£¼ìš” ê¸°ëŠ¥
- connect(): ì±„íŒ…ë°© ì—°ê²°
- disconnect(): ì—°ê²° í•´ì œ
- sendMessage(): ë©”ì‹œì§€ ì „ì†¡
- getMessageHistory(): ë©”ì‹œì§€ ížˆìŠ¤í† ë¦¬ ì¡°íšŒ
```

#### 2. React Hook (`src/hooks/useWebSocket.ts`)

```typescript
// useWebSocket Hook
interface UseWebSocketOptions {
  roomId: number;
  onMessage?: (message: ChatMessage) => void;
  onConnect?: () => void;
  onDisconnect?: () => void;
  onError?: (error: Event) => void;
}

// ë°˜í™˜ê°’
interface UseWebSocketReturn {
  messages: ChatMessage[];
  sendMessage: (content: string, type?: string) => void;
  isConnected: boolean;
  isConnecting: boolean;
  error: string | null;
  reconnect: () => void;
}
```

#### 3. ì—…ë°ì´íŠ¸ëœ ChatRoomPage (`src/pages/ChatRoomPage.tsx`)

- WebSocket Hook ì‚¬ìš©
- ì‹¤ì‹œê°„ ë©”ì‹œì§€ í‘œì‹œ
- ì—°ê²° ìƒíƒœ UI í‘œì‹œ
- ë©”ì‹œì§€ ì „ì†¡ ê¸°ëŠ¥

### ì‚¬ìš© ë°©ë²•

1. **ê°œë°œ ì„œë²„ ì‹œìž‘**

```bash
npm run dev
```

2. **ì±„íŒ…ë°© ì ‘ì†**

- ì•±ì—ì„œ ì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™
- WebSocket ì—°ê²° ìžë™ ì‹œìž‘
- ê¸°ì¡´ ë©”ì‹œì§€ ížˆìŠ¤í† ë¦¬ ë¡œë“œ

3. **ë©”ì‹œì§€ ì „ì†¡**

- í•˜ë‹¨ ìž…ë ¥ì°½ì— ë©”ì‹œì§€ ìž…ë ¥
- Enter í‚¤ ë˜ëŠ” ì „ì†¡ ë²„íŠ¼ í´ë¦­
- ì‹¤ì‹œê°„ìœ¼ë¡œ ë‹¤ë¥¸ ì‚¬ìš©ìžì—ê²Œ ë©”ì‹œì§€ ì „ë‹¬

### API ìŠ¤íŽ™ ì¤€ìˆ˜

ì›¹ì†Œì¼“ êµ¬í˜„ì€ `API_SPEC.md`ì˜ ë‹¤ìŒ ìŠ¤íŽ™ì„ ë”°ë¦…ë‹ˆë‹¤:

#### WebSocket ì—°ê²°

```
wss://api.wehand.tennis/ws/chats/{roomId}
```

#### ë©”ì‹œì§€ í˜•ì‹

```json
{
  "type": "message",
  "data": {
    "id": 123,
    "sender": "ê¹€í…Œë‹ˆìŠ¤",
    "content": "ì•ˆë…•í•˜ì„¸ìš”!",
    "timestamp": "14:05",
    "messageType": "text"
  }
}
```

### ìžë™ ê¸°ëŠ¥

1. **ìžë™ ìž¬ì—°ê²°**: ì—°ê²°ì´ ëŠì–´ì§€ë©´ ìµœëŒ€ 5íšŒ ìžë™ ìž¬ì—°ê²° ì‹œë„
2. **ìžë™ ë©”ì‹œì§€**: 30ì´ˆ~2ë¶„ ê°„ê²©ìœ¼ë¡œ ëžœë¤ ë©”ì‹œì§€ ìƒì„±
3. **ë©”ì‹œì§€ ì¤‘ë³µ ë°©ì§€**: ë™ì¼í•œ IDì˜ ë©”ì‹œì§€ ì¤‘ë³µ í‘œì‹œ ë°©ì§€
4. **ìŠ¤í¬ë¡¤ ìžë™ ì´ë™**: ìƒˆ ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ìžë™ìœ¼ë¡œ í•˜ë‹¨ ìŠ¤í¬ë¡¤

### ê°œë°œ í™˜ê²½ ì„¤ì •

WebSocket ëª©ì„œë²„ëŠ” ê°œë°œ í™˜ê²½ì—ì„œë§Œ í™œì„±í™”ë©ë‹ˆë‹¤:

```typescript
// ì „ì—­ WebSocket í´ëž˜ìŠ¤ ëª¨í‚¹ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ)
if (process.env.NODE_ENV === "development") {
  (globalThis as any).WebSocket = MockWebSocket;
}
```

### í…ŒìŠ¤íŠ¸ ë°©ë²•

1. **ë‹¨ì¼ ì‚¬ìš©ìž í…ŒìŠ¤íŠ¸**

   - ì±„íŒ…ë°© ìž…ìž¥
   - ë©”ì‹œì§€ ì „ì†¡
   - ìžë™ ë©”ì‹œì§€ ìˆ˜ì‹  í™•ì¸

2. **ë‹¤ì¤‘ ì°½ í…ŒìŠ¤íŠ¸**

   - ì—¬ëŸ¬ ë¸Œë¼ìš°ì € íƒ­ì—ì„œ ë™ì¼ ì±„íŒ…ë°© ì ‘ì†
   - í•œ íƒ­ì—ì„œ ë©”ì‹œì§€ ì „ì†¡
   - ë‹¤ë¥¸ íƒ­ì—ì„œ ì‹¤ì‹œê°„ ìˆ˜ì‹  í™•ì¸

3. **ì—°ê²° ìƒíƒœ í…ŒìŠ¤íŠ¸**
   - ë„¤íŠ¸ì›Œí¬ ì°¨ë‹¨ ì‹œë®¬ë ˆì´ì…˜
   - ìžë™ ìž¬ì—°ê²° í™•ì¸
   - ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ í™•ì¸

### í–¥í›„ ê°œì„  ì‚¬í•­

1. **íŒŒì¼ ì²¨ë¶€**: ì´ë¯¸ì§€/íŒŒì¼ ì „ì†¡ ê¸°ëŠ¥
2. **ì½ìŒ ìƒíƒœ**: ë©”ì‹œì§€ ì½ìŒ/ì•ˆì½ìŒ í‘œì‹œ
3. **íƒ€ì´í•‘ í‘œì‹œ**: ë‹¤ë¥¸ ì‚¬ìš©ìžê°€ ìž…ë ¥ ì¤‘ì¼ ë•Œ í‘œì‹œ
4. **í‘¸ì‹œ ì•Œë¦¼**: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ ì•Œë¦¼
5. **ë©”ì‹œì§€ ê²€ìƒ‰**: ì±„íŒ… ížˆìŠ¤í† ë¦¬ ê²€ìƒ‰ ê¸°ëŠ¥

### ì£¼ì˜ì‚¬í•­

- í˜„ìž¬ëŠ” ê°œë°œ/í…ŒìŠ¤íŠ¸ ëª©ì ì˜ ëª©ì„œë²„ìž…ë‹ˆë‹¤
- ì‹¤ì œ ë°°í¬ ì‹œì—ëŠ” ì‹¤ì œ WebSocket ì„œë²„ë¡œ êµì²´ í•„ìš”
- ë©”ì‹œì§€ëŠ” ë©”ëª¨ë¦¬ì—ë§Œ ì €ìž¥ë˜ë¯€ë¡œ ìƒˆë¡œê³ ì¹¨ ì‹œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤
- ë³´ì•ˆ ê¸°ëŠ¥ (ì¸ì¦, ì•”í˜¸í™”)ì€ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤

---

ì´ WebSocket êµ¬í˜„ì„ í†µí•´ ì‹¤ì‹œê°„ ì±„íŒ… ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ì‚¬ìš©ìž ê²½í—˜ì„ ê°œì„ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

```
const socket = io('ws://localhost:3000', {
    auth: {
      token: 'your-jwt-token'
    }
  });

  socket.emit('join-chat-room', 'room-uuid');
  socket.on('new-message', (message) => {
    console.log('ìƒˆ ë©”ì‹œì§€:', message);
  });
```
